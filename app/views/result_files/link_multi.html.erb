<h1>Link Sequence Result Files to Samples</h1>

<h3>Debug:</h3>
<h4>Hello <%= current_user.auth_user.name %>, you want files from lab: id=<%= @lab.id %>, name=<%= @lab.lab_name %></h4>

<h3>Debug: Results on Filesystsem</h3>
<% @results_on_filesystem.each do |file|%>
  <%= file[:document] %><br />
<% end %>
<br />
<h3>Debug: Results in Database before save</h3>
<% @result_files_before_save.each do |file|%>
  <%= file[:document] %><br />
<% end %>
<br />
<% if (@files_saved != 0) %>
<fieldset class="info">
<label>New Files</label>
<ul>
<% @new_files.each do |document|%>
  <li><%= document %></li>
<% end %>
</ul>
</fieldset>
<% else %>
<h3>No new files</h3>
<% end %>
<br />
<h3>Debug: Files that already exist in DB</h3>
<% @exist_in_db.each do |document|%>
  <%= document %><br />
<% end %>
<br />
<h3>Choose Another Lab</h3>
<%= render :partial => 'lab_form', :locals => {:lab_list => @labs} %>
<br />
<fieldset class="form">
<legend>Link Results to Samples</legend>
<% form_tag(:action => :debug) do  %>
<table class="form-with-columns" border="0">
    <tr>
      <th>Link to Sample(s)</th>
      <th>Select Sample(s)</th>
      <th>Filename</th>
      <th>Content Type</th>
      <th>File Size</th>
      <th>Updated By</th>
      <th>Lab</th>
      <th>Notes</th>
    </tr>
    <% @result_files.each do |file| %>
    <!-- TODO: -->
    <!-- check file against linked file list to determine checked status -->
    <!-- prepare input fields to write to both results_files for and notes updates, and to linked table -->
    <!-- get username and labname for display, rather than just the numbers -->
    <tr>
      <td><%= check_box_tag("_result_files[checked_file][]") %></td>
      <td><%= select_tag("_result_files[sample_id]", options_from_collection_for_select(@samples, :id, :barcode_and_name), {:multiple => true, :size=> 4}) %></td>                      
      <td><%= h file.document %></td>
      <td><%= h file.document_content_type %></td>
      <td><%= h file.document_file_size %></td>
      <td><%= h file.updated_by %></td>
      <td><%= h file.lab_id %></td>
      <td><%= text_area_tag("_result_files[notes][]", nil, :rows => 3, :cols => 15) %><% h file.notes %></td>
    </tr>    
    <% end %>   
</table>
</fieldset>
<%= break_clear(submit_tag "Submit") %>
<% end %>


